{% extends 'base/base.html' %}
{% load static %}
{% block title %} Register {% endblock %}

{% block content %}
<div class="alert alert-danger alert-dismissible text-white fade show" role="alert" id="alert_div" hidden >

    <span class="alert-text" id="err_msg"><strong></strong></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
   <div class = "container">
    
        <h1 class = "mt-3 mb-4 display-3 text-center">Register</h1>
        <form id="my-form" class = "form-container bg-white rounded shadow-blur p-3" name = "MsRegistration" action ="{% url 'otherdetails' %}" method = "POST">
            {% csrf_token %}
             {% for field in form %}
              <div class = "form-group row">
                {{ field.label_tag }}
                {{ field }}
                <span class = "h6" style = "color:red;">{{ field.errors }} </span>
             {% endfor %}
            <br>
            <div style = "text-align: center;">
                
                <button type="button" class = "btn btn-primary" onclick="get_lat_lng()" >GetLatLng</button>
                <button id="register-btn" data-bs-toggle="modal" data-bs-target="#exampleModal" class = "btn btn-primary" >Register</button>
            </div>
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title font-weight-normal" id="exampleModalLabel">Check District</h5>
                      <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <h6>Please Check your District input.As it will be used to create cluster.</h6>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn bg-gradient-secondary" data-bs-dismiss="modal">Close</button>
                      <button type="submit" id="modal-submit" class="btn bg-gradient-primary">Submit Form</button>
                    </div>
                  </div>
                </div>
              </div>
        </form>
            
    </div>
    <!-- Modal -->
    
{% endblock %}

{% block other_css %}

<style>
    form {
        width: 50%;
        margin: 0 auto;
        padding: 2%;
    }

</style>
<script>
    async function get_lat_lng() {

    add=document.getElementById("id_address").value
    city=document.getElementById("id_city").value
    if(add !="" && city !=""){
        address=add+" "+city
        var apikey=JSON.parse('{{ apikey|escapejs }}');

        const url = `https://maps.googleapis.com/maps/api/geocode/json?address=${address}&key=${apikey}`;

        try {
            const response = await fetch(url);
            const json = await response.json();
            const lat = json.results[0].geometry.location.lat;
            const lng = json.results[0].geometry.location.lng;
            document.getElementById("id_latitude").value = lat;
            document.getElementById("id_longitude").value = lng;
            
        }
        catch (error) {
            console.error(error);
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    let lat = position.coords.latitude;
                    let lng = position.coords.longitude;
                    document.getElementById("id_latitude").value = lat;
                    document.getElementById("id_longitude").value = lng;
                });
            }

        }
    

    }
    else{
        $("#alert_div").attr("hidden",false);
        $("#err_msg").text("Enter Address and City to get Latitude and Longitude");
        console.log("Enter");
    }
    
}
const registerBtn = document.querySelector('#register-btn');
const form = document.querySelector('#my-form');
const modal = new mdc.dialog.MDCDialog(document.querySelector('#modal'));
const mb=document.querySelector('modal-submit')

registerBtn.addEventListener('click', (event) => {
  event.preventDefault(); // prevent form from submitting
  modal.open();
});

mb.addEventListener('click',(event)=>{
  event.preventDefault();
  form.submit()
  modal.close()
})


// async function get_lat_lng(address) {
//     const url = "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find?text=${address}&f=json";
//     try {
//         const response = await fetch(url);
//         const json = await response.json();
//         const lat = json.locations[0].feature.geometry.y;
//         const lng = json.locations[0].feature.geometry.x;
//         document.getElementById("id_latitude").value = lat;
//         document.getElementById("id_longitude").value =lng;
//     } catch (error) {
//         console.error(error);
//     }
// }

</script>
{% endblock %}

